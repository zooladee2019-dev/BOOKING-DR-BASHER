<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</title>

<!-- Google Identity -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
:root{
  --app-bg:#b905f5;
  --btn:#f5e90a;
  --card:#ffffff;
}

body{
  font-family:Tahoma;
  background:#eee;
  display:flex;
  justify-content:center;
  padding:20px;
}

.app{
  width:390px;
  background:var(--app-bg);
  padding:15px;
  border-radius:18px;
}

.card{
  background:var(--card);
  padding:15px;
  border-radius:14px;
}

h2{text-align:center}

input,select{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:6px;
  border:1px solid #ddd;
}

button{
  width:100%;
  padding:12px;
  margin-top:6px;
  background:var(--btn);
  border:none;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
}

.hidden{display:none}

.list{margin-top:10px;font-size:14px}
.item{background:#f3f3f3;padding:8px;border-radius:6px;margin-bottom:6px}
</style>
</head>

<body>

<div class="app">
  <div class="card">

    <h2>Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ø·Ø¨ÙŠ</h2>

    <!-- Google Login -->
    <div id="loginBox">
      <div id="g_id_onload"
           data-client_id="PUT_YOUR_CLIENT_ID_HERE"
           data-callback="handleLogin">
      </div>

      <div class="g_id_signin" data-type="standard"></div>
    </div>

    <!-- Booking Form -->
    <div id="formBox" class="hidden">

      <p id="userEmail"></p>

      <input id="fname" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„">
      <input id="lname" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£Ø®ÙŠØ±">
      <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">

      <select id="service">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø©</option>
        <option>Ø·Ø¨ÙŠØ¨ Ø¹Ù…ÙˆÙ…ÙŠ</option>
        <option>Ø·Ø¨ÙŠØ¨ Ø£Ø·ÙØ§Ù„</option>
        <option>Ø·Ø¨ÙŠØ¨ Ù†Ø³Ø§Ø¡ ÙˆØªÙˆÙ„ÙŠØ¯</option>
        <option>Ø·Ø¨ÙŠØ¨ Ø¨Ø§Ø·Ù†ÙŠØ©</option>
      </select>

      <input type="date" id="date">

      <select id="time">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ‚Øª</option>
        <option>09:00</option>
        <option>10:00</option>
        <option>11:00</option>
        <option>12:00</option>
      </select>

      <button onclick="book()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²</button>
      <button onclick="loadBookings()">Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</button>

      <div class="list" id="list"></div>
    </div>

  </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxYBO-2g3v5LL7U03xbFdhq6NRVHHsEjXefOUYrJmOnrsA4ofjmAXFB4ixrtFrPi352/exec";

let userEmail = "";

function handleLogin(response){
  const data = JSON.parse(atob(response.credential.split('.')[1]));
  userEmail = data.email;

  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("formBox").classList.remove("hidden");
  document.getElementById("userEmail").innerText = "ğŸ“§ " + userEmail;
}

function randomID(){
  return Math.floor(100000 + Math.random() * 900000);
}

function book(){
  if(!userEmail){
    alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    return;
  }

  const booking = {
    id: randomID(),
    name: fname.value + " " + lname.value,
    email: userEmail,
    phone: phone.value,
    service: service.value,
    date: date.value,
    time: time.value
  };

  fetch(SCRIPT_URL,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(booking)
  })
  .then(r => r.json())
  .then(res => {
    if(res.status === "success"){
      alert("ØªÙ… Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­ âœ…");
      clearForm();
    } else {
      alert("ÙØ´Ù„ Ø§Ù„Ø­Ø¬Ø² âŒ");
    }
  })
  .catch(()=> alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„"));
}

function loadBookings(){
  fetch(SCRIPT_URL)
    .then(r => r.json())
    .then(data => {
      list.innerHTML = "";
      data.forEach(b=>{
        list.innerHTML += `
          <div class="item">
            ğŸ”¢ ${b.id}<br>
            ğŸ‘¤ ${b.name}<br>
            ğŸ“§ ${b.email}<br>
            ğŸ“ ${b.phone}<br>
            ğŸ©º ${b.service}<br>
            ğŸ“… ${b.date} - ${b.time}
          </div>`;
      });
    });
}

function clearForm(){
  document.querySelectorAll("input,select").forEach(e => e.value = "");
}
</script>

</body>
</html>
